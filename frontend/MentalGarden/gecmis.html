<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GeÃ§miÅŸ Ruh Halleri</title>
  <link rel="stylesheet" href="style.css?v=4" />
  <style>
    /* Stiller aynÄ± kalabilir (kÄ±smÄ± kestim) */
  </style>
</head>
<body>

<header>
  <a href="anasayfa.html">
    <img src="assets/logo.svg" alt="MentalGarden Logo" class="logo">
  </a>
  <nav class="navbar">
    <a href="gÃ¼nlÃ¼gÃ¼m.html">GÃ¼nlÃ¼k</a>
    <a href="bahcem.html">BahÃ§em</a>
    <a href="bahcemiz.html">BahÃ§emiz</a>
    <a href="gecmis.html">GeÃ§miÅŸ</a>
    <a href="hakkimizda.html">HakkÄ±mÄ±zda</a>
  </nav>
  <a href="#" class="profile-btn">
    <img src="assets/profile-icon.svg" alt="Profil">
  </a>
</header>

<main class="container">
  <h1>GeÃ§miÅŸ Ruh Halleri</h1>
  <p>Son 7 gÃ¼n boyunca kendini nasÄ±l hissettiÄŸini ve yazdÄ±klarÄ±nÄ± buradan gÃ¶rebilirsin ğŸŒ±</p>

  <div class="mood-grid" id="moodGrid"></div>

  <h2 style="margin-top: 3rem;">ğŸ“– GÃ¼nlÃ¼k GeÃ§miÅŸi</h2>
  <div id="journalList" style="text-align:left; max-width:600px; margin:auto; font-size:0.95rem; color:#4b3b3b;"></div>
</main>

<script>
  const moodDescriptions = [
    "BugÃ¼n biraz stresli hissediyordum.",
    "Biraz Ã¼zgÃ¼ndÃ¼m bugÃ¼n.",
    "Ne iyi ne kÃ¶tÃ¼, dengeli bir gÃ¼ndÃ¼.",
    "Kendimi oldukÃ§a iyi hissediyordum.",
    "BugÃ¼n Ã§ok mutlu hissediyordum!"
  ];

  function formatDate(isoDate) {
    const months = [
      "Ocak", "Åubat", "Mart", "Nisan", "MayÄ±s", "Haziran",
      "Temmuz", "AÄŸustos", "EylÃ¼l", "Ekim", "KasÄ±m", "AralÄ±k"
    ];
    const d = new Date(isoDate);
    return `${d.getDate()} ${months[d.getMonth()]} ${d.getFullYear()}`;
  }

  async function loadMoodHistory(username) {
    const response = await fetch(`http://localhost:8000/mood-history/${username}`);
    const moodData = await response.json();

    const moodGrid = document.getElementById("moodGrid");
    moodGrid.innerHTML = "";

    moodData.reverse().forEach(entry => {
      const card = document.createElement("div");
      card.className = "mood-card";
      card.innerHTML = `
        <p class="mood-date">${formatDate(entry.date)}</p>
        <img src="assets/tree${entry.mood}.svg" alt="Mood" class="mood-image" />
        <p class="mood-desc">${moodDescriptions[entry.mood]}</p>
      `;
      moodGrid.appendChild(card);
    });
  }

  async function loadJournals(username) {
    const res = await fetch(`http://localhost:8000/journal/${username}`);
    const data = await res.json();

    const container = document.getElementById("journalList");
    container.innerHTML = "";

    data.reverse().forEach(entry => {
      const p = document.createElement("p");
      p.textContent = `ğŸ—“ï¸ ${formatDate(entry.date)}: ${entry.entry}`;
      container.appendChild(p);
    });
  }

  window.addEventListener("DOMContentLoaded", () => {
    const username = localStorage.getItem("username") || "defaultUser";
    loadMoodHistory(username);
    loadJournals(username);
  });
</script>

</body>
</html>
